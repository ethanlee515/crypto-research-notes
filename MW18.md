# Relating KL-divergence to Cryptographic Game Hops

The paper ["Gaussian Sampling over the Integers: Efficient, Generic, Constant-Time"](ia.cr/2017/259) shows a way to substitute a distribution from a cryptographic game with another similar distribution.
TODO write better

## Provided proof

Here we give my version of the provided proof...
Skips some steps in the paper but whatever

## Challenges

Given an adversary, there are no easy way to clone and run n independent copies of it.
It is possible that the [rewinding paper](ia.cr/2021/1078) might be useful to reset the adversary between runs but we don't know.

## Our changes to the proof

1. Instantiate the adversary as the optimal one and run n independent copies of that
2. Prove that my adversary is indeed optimal

We start by giving a description of the optimal adversary...
TODO

## Analyzing Total Variation Distance in EasyCrypt

TODO exposition?

### The EasyCrypt `SDist` library

EasyCrypt provides a [library](https://github.com/EasyCrypt/easycrypt/blob/main/theories/distributions/SDist.ec) for the total variation distance.
Roughly speaking, it defines total variation distance between distributions and identifies the adversary's actions with distributions over corresponding outputs.
Unfortunately, this strategy does not generalize easily to a situation when there are inputs to the oracle calls and where the adversary is (in principle, syntactically) adaptive.
It is complicated to model such an adversary. On pen and paper, this amounts to:
1. assume without the loss of generality that the adversary is deterministic
2. writing down the next-message functions of the adversary

The first step might be tedious to prove in full generality, and the second step gives a very unwieldy model of the adversary.

### Our strategy

Here we propose instead to use the chain rule of probability to construct partical couplings.
We observe that given two distributions $\mathcal{X}_1$ and $\mathcal{X}_2$, we can construct a sub-distribution $\mathcal{X}\_{\wedge}$ of their overlap as
$$\Pr[\mathcal{X}\_\wedge=x]=\min(\Pr[\mathcal{X}\_1=x], \Pr[\mathcal{X}\_2=x]).$$
We can then rewrite
$$\mathcal{X}_1=TODO$$
and similarly for $\mathcal{X}_2$.
